- Rebuild the code using a vector of segments
